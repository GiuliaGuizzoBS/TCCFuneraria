<%- include('partials/navbarCliente') %>

<style>
/* === ESTILO DOS CARDS DE PRODUTOS E PEDIDOS === */
.produto-card, .pedido-card {
  background-color: #fff8eb !important;
  border: 1px solid #d9c8b8;
  border-radius: 15px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  padding: 20px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.produto-card:hover, .pedido-card:hover {
  transform: scale(1.01);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}
.pedido-card h5, .produto-card h5 {
  color: #57330f;
}
.pedido-card hr, .produto-card hr {
  border-color: #d9c8b8;
}
</style>

<h2 class="mt-4 titulo-centralizado"><strong>Pedidos Esperando Confirmação</strong></h2>

<div class="container mt-4">
  <% if (produtos.length > 0) { %>
    <% produtos.forEach(produto => { %>
      <div class="produto-card mb-3">
        <h5 class="texto-marrom"><%= produto.nome %></h5>
        <p><%= produto.descricao %></p>
        <p class="fw-bold texto-marrom">
          R$ <%= Number(produto.preco).toFixed(2) %> x <%= produto.quantidade %>
        </p>
        <form action="/pedidos/remover" method="POST">
          <input type="hidden" name="produto_id" value="<%= produto.id %>">
          <button type="submit" class="btn btn-marrom btn-sm mt-2">Remover</button>
        </form>
      </div>
    <% }); %>

    <div class="d-flex gap-2 mt-3">
      <form action="/formulario" method="GET">
        <button type="submit" class="btn btn-success">Finalizar Pedido</button>
      </form>
      <a href="/servicos" class="btn btn-secondary">Continuar Comprando</a>
    </div>
  <% } else { %>
    <p class="text-center fw-bold mt-4">Nenhum produto no seu carrinho.</p>
  <% } %>
</div>

<h2 class="mt-5 titulo-centralizado"><strong>Pedidos Confirmados</strong></h2>

<div class="container mt-4">
  <% if (confirmados && confirmados.length > 0) { %>
    <% confirmados.forEach(p => { %>
      <div class="pedido-card mb-4 rounded shadow-sm">
        <h5 class="texto-marrom mb-3">
          <strong>Pedido nº <%= p.pedido_id %></strong>
        </h5>

        <p><strong>Status:</strong> <%= p.status %></p>
        <p><strong>Data:</strong> 
          <%= p.criado_em ? new Date(p.criado_em).toISOString().split('T')[0] : '—' %>
        </p>
        <p><strong>Cliente:</strong> <%= p.cliente || 'Não informado' %></p>
        <p><strong>Valor:</strong> R$ <%= p.valor ? Number(p.valor).toFixed(2) : '—' %></p>
        <p><strong>Forma de Pagamento:</strong> <%= p.forma_de_pagamento || '—' %></p>

        <% if (p.produtos) { %>
          <hr>
          <h6 class="texto-marrom mt-3">Produtos</h6>
          <ul class="list-unstyled ms-3">
            <% p.produtos.split(',').forEach(prod => { %>
              <li>• <%= prod.trim() %></li>
            <% }) %>
          </ul>
        <% } %>

        <% if (p.cremacao !== null || p.translado || p.horario) { %>
          <hr>
          <h6 class="texto-marrom mt-3">Formulário</h6>
          <p><strong>Cremação:</strong> <%= p.cremacao ? 'Sim' : 'Não' %></p>
          <p><strong>Horário:</strong> <%= p.horario || '—' %></p>
          <p><strong>Translado:</strong> <%= p.translado || '—' %></p>
        <% } %>

        <% if (p.roupa || p.batom || p.unha || p.observacao) { %>
          <hr>
          <h6 class="texto-marrom mt-3">Necromaquiagem</h6>
          <p>
            Roupa: <%= p.roupa || '—' %> |
            Roupas íntimas: <%= p.r_intimas ? 'Sim' : 'Não' %> |
            Batom: <%= p.batom || '—' %> |
            Unha: <%= p.unha || '—' %> |
            Cabelo: <%= p.cabelo || '—' %> |
            Intensidade: <%= p.intensidade ? 'Alta' : 'Normal' %>
          </p>
          <p><strong>Observação:</strong> <%= p.observacao || '—' %></p>
        <% } %>

        <% if (p.embacamento !== null || p.tanatopraxia !== null) { %>
          <hr>
          <h6 class="texto-marrom mt-3">Laboratório</h6>
          <p>
            Embalsamamento: <%= p.embacamento ? 'Sim' : 'Não' %> |
            Tanatopraxia: <%= p.tanatopraxia ? 'Sim' : 'Não' %> |
            Aspiração: <%= p.aspiracao ? 'Sim' : 'Não' %> |
            Restauração: <%= p.restauracao ? 'Sim' : 'Não' %> |
            Mumificação: <%= p.mumificacao ? 'Sim' : 'Não' %> |
            Higienização: <%= p.higienizacao ? 'Sim' : 'Não' %>
          </p>
        <% } %>

        <% if (p.cortina !== null || p.tapete !== null) { %>
          <hr>
          <h6 class="texto-marrom mt-3">Cama Ardente</h6>
          <p>
            Cortina: <%= p.cortina ? 'Sim' : 'Não' %> |
            Tapete: <%= p.tapete ? 'Sim' : 'Não' %> |
            Livro Pré: <%= p.livropre ? 'Sim' : 'Não' %> |
            Veleiro: <%= p.veleiro ? 'Sim' : 'Não' %> |
            Cristo: <%= p.cristo ? 'Sim' : 'Não' %> |
            Bíblia: <%= p.biblia ? 'Sim' : 'Não' %> |
            Cavalete: <%= p.cavalete ? 'Sim' : 'Não' %>
          </p>
        <% } %>

        <% if (p.rua || p.numero || p.bairro || p.cidade) { %>
          <hr>
          <h6 class="texto-marrom mt-3">Endereço</h6>
          <p>
            <%= p.rua || 'Rua não informada' %>, 
            <%= p.numero || 's/n' %> - 
            <%= p.bairro || '' %>, 
            <%= p.cidade || '' %> / 
            <%= p.estado || '' %> - 
            <%= p.pais || '' %>
          </p>
        <% } %>
      </div>
    <% }) %>
  <% } else { %>
    <p class="text-center fw-bold mt-4">Nenhum pedido confirmado ainda.</p>
  <% } %>
</div>
