<%- include('partials/navbarCliente') %>
<h2 class="mt-4 titulo-centralizado"><strong>Funerais</strong></h2>

<div class="container mt-4">
  <div class="row">
    <%
      const lista = Array.isArray(produtos) ? produtos : [];

      const getImg = (p) => (p?.imagem_url ?? p?.imagemUrl ?? p?.imagem ?? p?.foto_url ?? '/img/placeholder.jpg');
      const getNome = (p) => (p?.nome ?? p?.titulo ?? p?.name ?? 'Produto');
      const getDesc = (p) => (p?.descricao ?? p?.descr ?? p?.description ?? '');
      const getPreco = (p) => {
        const v = Number(p?.preco ?? p?.valor ?? p?.price ?? 0);
        return isNaN(v) ? 0 : v;
      };

      // Filtra por nome da categoria (caixão = funerais)
      const itens = lista.filter(p => (p.categoria_nome ?? '').toLowerCase() === 'caixão');
    %>

    <% if (itens.length > 0) { %>
      <% itens.forEach(produto => { %>
        <div class="col-md-4 mb-4">
          <div class="feature-card h-100 d-flex flex-column justify-content-between">
            <img src="<%= getImg(produto) %>" class="card-img-top rounded" alt="<%= getNome(produto) %>" style="height: 200px; object-fit: cover;">
            <div class="mt-3">
              <h5 class="card-title text-capitalize texto-marrom"><%= getNome(produto) %></h5>
              <% if (getDesc(produto)) { %>
                <p class="card-text text-muted"><%= getDesc(produto) %></p>
              <% } %>
              <p class="card-text fw-bold texto-marrom">R$ <%= getPreco(produto).toFixed(2).replace('.', ',') %></p>
            </div>
            <a href="#" class="btn btn-marrom mt-3 w-100">Comprar</a>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p class="text-center">Nenhum produto de funerais encontrado.</p>
    <% } %>
  </div>
</div>
